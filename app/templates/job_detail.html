{% extends "base.html" %}

{% block title %}Job Details{% endblock %}

{% block extra_head %}
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>
<link rel="stylesheet" href="{{ url_for('static', filename='job_detail.css') }}">
{% endblock %}

{{error}}

{% block content %}
<div class="flex flex-col items-center max-w-4xl mx-auto">
  <h1 class="text-3xl font-bold mb-4 text-center">{{ job_title or "Job Details" }}</h1>
  
  <div class="bg-neutral-primary-soft block w-full p-6 border border-default rounded-base shadow-xs mb-6">
    <h2 class="mb-3 text-2xl font-semibold tracking-tight text-heading leading-8">{{ employer or "Unknown Employer" }}</h2>

    {% if source %}
      <p class="text-body text-sm mb-2"><strong>Source:</strong> {{ source }}</p>
    {% endif %}

    <p class="text-body text-sm mb-2"><strong>Location:</strong> {{ location_name or "Not specified" }}</p>

    {% if schedule %}
      <p class="text-body text-sm mb-2"><strong>Schedule:</strong> {{ schedule }}</p>
    {% endif %}

    {% if start_date %}
      <p class="text-body text-sm mb-2"><strong>Start Date:</strong> {{ start_date }}</p>
    {% endif %}

    {% if end_date %}
      <p class="text-body text-sm mb-2"><strong>End Date:</strong> {{ end_date }}</p>
    {% endif %}

    {% if salary_min is not none or salary_max is not none %}
      <p class="text-body text-sm mb-2"><strong>Salary:</strong>
        {% if salary_min is not none and salary_max is not none %}
          ${{ "{:,.0f}".format(salary_min) }} - ${{ "{:,.0f}".format(salary_max) }}/year
        {% elif salary_min is not none %}
          ${{ "{:,.0f}".format(salary_min) }}+/year
        {% else %}
          Up to ${{ "{:,.0f}".format(salary_max) }}/year
        {% endif %}
      </p>
    {% endif %}

    <div class="flex gap-3 mt-4">
      {% if link %}
      <a href="{{ link }}" target="_blank" class="inline-flex items-center text-white bg-green-600 border border-transparent hover:bg-green-700 focus:ring-4 focus:ring-green-200 shadow-xs font-medium rounded-base text-sm px-4 py-2 focus:outline-none">
        Apply Now
      </a>
      {% endif %}

      <form action="{{ url_for('save_job') }}" method="POST" class="inline">
        <input type="hidden" name="job_title" value="{{ job_title }}">
        <input type="hidden" name="employer" value="{{ employer }}">
        <input type="hidden" name="location_name" value="{{ location_name }}">
        <input type="hidden" name="schedule" value="{{ schedule }}">
        <input type="hidden" name="start_date" value="{{ start_date }}">
        <input type="hidden" name="end_date" value="{{ end_date }}">
        <input type="hidden" name="link" value="{{ link }}">
        <input type="hidden" name="lat" value="{{ lat }}">
        <input type="hidden" name="lon" value="{{ lon }}">
        <button type="submit" class="inline-flex items-center text-white bg-brand border border-transparent hover:bg-brand-strong focus:ring-4 focus:ring-brand-medium shadow-xs font-medium rounded-base text-sm px-4 py-2 focus:outline-none">
          Save This Job
        </button>
      </form>
    </div>
  </div>

  {% if has_map %}
    <h3 class="text-2xl font-bold mb-3">location map</h3>
    <div id="map" style="height: 500px; width: 100%; max-width: 800px;" class="rounded shadow-lg"></div>
  {% endif %}
</div>

{% endblock %}

{% block extra_scripts %}
{% if has_map %}
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>

<script>
  const lat = parseFloat({{ lat | tojson }});
  const lon = parseFloat({{ lon | tojson }});

  const map = L.map("map").setView([lat, lon], 12);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors',
  }).addTo(map);

  L.marker([lat, lon])
    .addTo(map)
    .bindPopup(`<strong>{{ employer|e }}</strong><br>{{ location_name|e }}`)
    .openPopup();
</script>
{% endif %}
{% endblock %}
