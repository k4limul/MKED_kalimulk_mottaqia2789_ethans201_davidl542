{% extends "base.html" %}

{% block title %}Job Details{% endblock %}

{% block extra_head %}
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>
<style>
  .job-info-card {
    background-color: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .info-row {
    margin-bottom: 10px;
  }
</style>
{% endblock %}

{{error}}

{% block content %}
<div class="flex flex-col items-center max-w-4xl mx-auto">
  <h1 class="text-3xl font-bold mb-4 text-center">{{ job_title or "Job Details" }}</h1>
  
  <div class="job-info-card w-full">
    <h2 class="text-2xl font-semibold text-gray-800 mb-3">{{ employer or "Unknown Employer" }}</h2>
    
    <div class="info-row">
      <p><strong>Location:</strong> {{ location_name or "Not specified" }}</p>
    </div>

    {% if schedule %}
    <div class="info-row">
      <p><strong>Schedule:</strong> {{ schedule }}</p>
    </div>
    {% endif %}

    {% if start_date %}
    <div class="info-row">
      <p><strong>Start Date:</strong> {{ start_date }}</p>
    </div>
    {% endif %}

    {% if end_date %}
    <div class="info-row">
      <p><strong>End Date:</strong> {{ end_date }}</p>
    </div>
    {% endif %}

    <div class="info-row mt-4 flex gap-3">
      {% if link %}
      <a href="{{ link }}" target="_blank" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-medium inline-block">
        Apply Now
      </a>
      {% endif %}
      
      <form action="{{ url_for('save_job') }}" method="POST" class="inline">
        <input type="hidden" name="job_title" value="{{ job_title }}">
        <input type="hidden" name="employer" value="{{ employer }}">
        <input type="hidden" name="location_name" value="{{ location_name }}">
        <input type="hidden" name="schedule" value="{{ schedule }}">
        <input type="hidden" name="start_date" value="{{ start_date }}">
        <input type="hidden" name="end_date" value="{{ end_date }}">
        <input type="hidden" name="link" value="{{ link }}">
        <button type="submit" class="bg-amber-700 hover:bg-amber-800 text-white px-4 py-2 rounded font-medium">
          Save This Job
        </button>
      </form>
    </div>
  </div>

  <h3 class="text-2xl font-bold mb-3">Location Map</h3>
  <div id="map" style="height: 500px; width: 100%; max-width: 800px;" class="rounded shadow-lg"></div>
</div>

{% endblock %}

{% block extra_scripts %}
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>

<script>
  const lat = parseFloat({{ lat | tojson }});
  const lon = parseFloat({{ lon | tojson }});

  const map = L.map("map").setView([lat, lon], 12);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors',
  }).addTo(map);

  L.marker([lat, lon])
    .addTo(map)
    .bindPopup(`<strong>{{ employer|e }}</strong><br>{{ location_name|e }}`)
    .openPopup();
</script>
{% endblock %}
